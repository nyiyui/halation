<style>
  label {
    display: block;
  }
</style>
{{ $root := . }}
<form method="post">
  <label>
    Name
    <input type="text" name="name" value="{{ .nodeName }}" />
  </label>
  <label>
    Description
    <input type="text" name="description" value="{{ .node.GetDescription }}" />
  </label>
  <label>
    Type
    <select name="type">
      {{ range $i, $t := .availableNodeTypeNames }}
      <option value="{{ $t }}"{{ if eq $root.node.TypeName $t }} selected {{ end }}>{{ $t }}</option>
      {{ end }}
    </select>
  </label>
  {{ if eq .node.TypeName "nyiyui.ca/halation/node.SetState" }}
    <label>
      State Type
      <select name="state-type">
        <option value="">None</option>
        {{ range $i, $t := .availableStateTypeNames }}
        <option value="{{ $t }}"{{ if and $root.node.SG.State (eq $root.node.SG.State.TypeName $t) }} selected {{ end }}>{{ $t }}</option>
        {{ end }}
      </select>
    </label>
    <label>
      State
      <textarea name="state" rows="10" cols="40">{{ printf "%s" (toJSON .node.SG.State) }}</textarea>
    </label>
    <label>
      Gradient Type
      <select name="gradient-type">
        <option value="">None</option>
        {{ range $i, $t := .availableGradientTypeNames }}
        <option value="{{ $t }}"{{ if and $root.node.SG.Gradient (eq $root.node.SG.Gradient.TypeName $t) }} selected {{ end }}>{{ $t }}</option>
        {{ end }}
      </select>
    </label>
    <label>
      Gradient
      <textarea name="gradient" rows="10" cols="40">{{ printf "%s" (toJSON .node.SG.Gradient) }}</textarea>
    </label>
  {{ end }}
  <label>
    Listens To
    <textarea name="listens-to" rows="10" cols="40">{{ printf "%s" (toJSON .node.GetListensTo) }}</textarea>
  </label>
  {{ if .htmx }}
  <button hx-post="/edit?node-name={{ .nodeName }}" hx-target="closest .popup">
    Save
  </button>
  {{ else }}
  <input type="submit" value="Save"/>
  {{ end }}
  {{/* TODO: saved notification */}}
</form>
<details>
  <summary>Raw JSON</summary>
<pre>
{{ printf "%s" (toJSON .node) }}
</pre>
</details>
